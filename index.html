<!DOCTYPE html>
<html lang="ru" class="bg-gray-100">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Giftomania üéÅ</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    .gift-card {
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      cursor: pointer;
    }
    .gift-card:hover, .gift-card:focus-visible {
      transform: scale(1.05);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);
      outline: none;
    }
    .active-tab {
      border-bottom-width: 2px;
      border-color: #8b5cf6;
      color: #8b5cf6;
    }
    /* –ú–æ–¥–∞–ª–∫–∞ */
    #modal {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      transition: opacity 0.3s ease;
    }
    #modal[hidden] {
      display: none;
    }
    button:focus-visible {
      outline: 2px solid #8b5cf6;
      outline-offset: 2px;
    }
    /* –ü–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ */
    #balance {
      transition: all 0.3s ease;
    }
  </style>
</head>
<body class="font-sans text-gray-900 dark:text-white dark:bg-gray-900 transition-all">

  <script>
    const tg = Telegram.WebApp;
    tg.expand();

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º—ã
    const theme = tg.colorScheme || 'light';
    document.documentElement.classList.toggle('dark', theme === 'dark');

    // –ë–∞–ª–∞–Ω—Å
    let balance = Number(localStorage.getItem('balance')) || 100;

    function updateBalanceDisplay() {
      const balanceElem = document.getElementById('balance');
      balanceElem.textContent = `${balance} ‚≠ê`;
    }

    function saveBalance() {
      localStorage.setItem('balance', balance);
    }

    window.addEventListener('load', () => {
      updateBalanceDisplay();
      initTabs();
    });
  </script>

  <!-- Header -->
  <header class="bg-purple-600 text-white px-4 py-4 rounded-b-2xl shadow flex items-center justify-between">
    <h1 class="text-xl font-bold select-none">Giftomania üéÅ</h1>
    <span class="text-sm select-none">–ë–∞–ª–∞–Ω—Å: <strong id="balance">...</strong></span>
  </header>

  <!-- Tabs -->
  <nav class="flex justify-around mt-4 text-sm font-semibold text-purple-700 select-none" role="tablist" aria-label="–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã">
    <button id="tab-shop" class="active-tab pb-1 focus:outline-none" role="tab" aria-selected="true" tabindex="0" aria-controls="content-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
    <button id="tab-gifts" class="pb-1 text-gray-500 dark:text-gray-400 focus:outline-none" role="tab" aria-selected="false" tabindex="-1" aria-controls="content-gifts">–ú–æ–∏ –ø–æ–¥–∞—Ä–∫–∏</button>
  </nav>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–æ–≤ -->
  <section id="content-shop" role="tabpanel" tabindex="0" aria-labelledby="tab-shop" class="p-4 grid grid-cols-2 gap-4">
    <!-- –ü–æ–¥–∞—Ä–∫–∏ -->
    <div tabindex="0" role="button" aria-pressed="false" aria-label="–ö—É–ø–∏—Ç—å –ü–æ–¥–∞—Ä–æ–∫ —Å–æ –∑–≤—ë–∑–¥–∞–º–∏ –∑–∞ 15 –∑–≤—ë–∑–¥" onclick="openGift('–ü–æ–¥–∞—Ä–æ–∫ —Å–æ –∑–≤—ë–∑–¥–∞–º–∏', 15)" onkeypress="if(event.key==='Enter' || event.key===' ') openGift('–ü–æ–¥–∞—Ä–æ–∫ —Å–æ –∑–≤—ë–∑–¥–∞–º–∏', 15)" class="gift-card bg-white dark:bg-gray-800 rounded-xl p-4 text-center shadow transition">
      <img src="https://img.icons8.com/emoji/48/gift-emoji.png" alt="–ü–æ–¥–∞—Ä–æ–∫ —Å–æ –∑–≤—ë–∑–¥–∞–º–∏" class="mx-auto mb-2 w-10 h-10" />
      <h3 class="font-medium">–ü–æ–¥–∞—Ä–æ–∫ —Å–æ –∑–≤—ë–∑–¥–∞–º–∏</h3>
      <p class="text-sm text-gray-500 dark:text-gray-400">15 ‚≠ê</p>
    </div>
    <div tabindex="0" role="button" aria-pressed="false" aria-label="–ö—É–ø–∏—Ç—å –ë—Ä–æ–Ω–∑–æ–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∑–∞ 25 –∑–≤—ë–∑–¥" onclick="openGift('–ë—Ä–æ–Ω–∑–æ–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫', 25)" onkeypress="if(event.key==='Enter' || event.key===' ') openGift('–ë—Ä–æ–Ω–∑–æ–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫', 25)" class="gift-card bg-white dark:bg-gray-800 rounded-xl p-4 text-center shadow transition">
      <img src="https://img.icons8.com/color/48/gift.png" alt="–ë—Ä–æ–Ω–∑–æ–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫" class="mx-auto mb-2 w-10 h-10" />
      <h3 class="font-medium">–ë—Ä–æ–Ω–∑–æ–≤—ã–π</h3>
      <p class="text-sm text-gray-500 dark:text-gray-400">25 ‚≠ê</p>
    </div>
    <div tabindex="0" role="button" aria-pressed="false" aria-label="–ö—É–ø–∏—Ç—å –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∑–∞ 50 –∑–≤—ë–∑–¥" onclick="openGift('–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫', 50)" onkeypress="if(event.key==='Enter' || event.key===' ') openGift('–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫', 50)" class="gift-card bg-white dark:bg-gray-800 rounded-xl p-4 text-center shadow transition">
      <img src="https://img.icons8.com/office/48/gift.png" alt="–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫" class="mx-auto mb-2 w-10 h-10" />
      <h3 class="font-medium">–°–µ—Ä–µ–±—Ä—è–Ω—ã–π</h3>
      <p class="text-sm text-gray-500 dark:text-gray-400">50 ‚≠ê</p>
    </div>
    <div tabindex="0" role="button" aria-pressed="false" aria-label="–ö—É–ø–∏—Ç—å –ó–æ–ª–æ—Ç–æ–π –ø–æ–¥–∞—Ä–æ–∫ –∑–∞ 100 –∑–≤—ë–∑–¥" onclick="openGift('–ó–æ–ª–æ—Ç–æ–π –ø–æ–¥–∞—Ä–æ–∫', 100)" onkeypress="if(event.key==='Enter' || event.key===' ') openGift('–ó–æ–ª–æ—Ç–æ–π –ø–æ–¥–∞—Ä–æ–∫', 100)" class="gift-card bg-white dark:bg-gray-800 rounded-xl p-4 text-center shadow transition">
      <img src="https://img.icons8.com/fluency/48/gift.png" alt="–ó–æ–ª–æ—Ç–æ–π –ø–æ–¥–∞—Ä–æ–∫" class="mx-auto mb-2 w-10 h-10" />
      <h3 class="font-medium">–ó–æ–ª–æ—Ç–æ–π</h3>
      <p class="text-sm text-gray-500 dark:text-gray-400">100 ‚≠ê</p>
    </div>
    <div tabindex="0" role="button" aria-pressed="false" aria-label="–ö—É–ø–∏—Ç—å –°—É–ø–µ—Ä-–ø–æ–¥–∞—Ä–æ–∫ –∑–∞ 150 –∑–≤—ë–∑–¥" onclick="openGift('–°—É–ø–µ—Ä-–ø–æ–¥–∞—Ä–æ–∫', 150)" onkeypress="if(event.key==='Enter' || event.key===' ') openGift('–°—É–ø–µ—Ä-–ø–æ–¥–∞—Ä–æ–∫', 150)" class="gift-card bg-yellow-100 dark:bg-yellow-300 rounded-xl p-4 text-center shadow col-span-2 transition">
      <img src="https://img.icons8.com/external-flat-juicy-fish/48/external-gift-valentines-flat-flat-juicy-fish.png" alt="–°—É–ø–µ—Ä-–ø–æ–¥–∞—Ä–æ–∫" class="mx-auto mb-2 w-10 h-10" />
      <h3 class="font-medium">–°—É–ø–µ—Ä-–ø–æ–¥–∞—Ä–æ–∫</h3>
      <p class="text-sm text-yellow-800 dark:text-yellow-900">150 ‚≠ê</p>
    </div>
  </section>

  <section id="content-gifts" role="tabpanel" tabindex="0" aria-labelledby="tab-gifts" hidden class="p-4 text-center text-gray-500 dark:text-gray-400">
    <p>–ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤, –Ω–æ —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è! üéÅ</p>
  </section>

  <!-- Bottom Navigation -->
  <nav class="fixed bottom-0 left-0 w-full bg-white dark:bg-gray-800 border-t border-gray-300 dark:border-gray-700 flex justify-around py-3 text-sm z-50 select-none" aria-label="–ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <button class="text-purple-700 font-semibold focus:outline-none focus:ring-2 focus:ring-purple-500 rounded">üéÅ –û—Ç–∫—Ä—ã–≤–∞–π</button>
    <button class="text-gray-500 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 rounded">üéü –í—ã–∏–≥—Ä–∞–π NFT</button>
    <button class="text-gray-500 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 rounded">üë• –ü—Ä–∏–≥–ª–∞—à–∞–π</button>
  </nav>

  <!-- –ú–æ–¥–∞–ª–∫–∞ -->
  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-text" class="fixed inset-0 flex items-center justify-center z-50 hidden" tabindex="-1">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl w-72 text-center shadow-lg relative">
      <h2 id="modal-title" class="text-lg font-bold mb-2 select-none"></h2>
      <p id="modal-text" class="text-gray-500 dark:text-gray-400 mb-4 select-none"></p>
      <button onclick="closeModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow focus:outline-none focus:ring-2 focus:ring-purple-500">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <script>
    // –õ–æ–≥–∏–∫–∞ –º–æ–¥–∞–ª–∫–∏
    const modal = document.getElementById('modal');

    function openGift(name, price) {
      if (balance < price) {
        showModal("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥", `–£ —Ç–µ–±—è –≤—Å–µ–≥–æ ${balance} ‚≠ê`);
        return;
      }

      balance -= price;
      saveBalance();
      updateBalanceDisplay();

      const prizes = ["10 ‚≠ê", "50 ‚≠ê", "–Ω–∏—á–µ–≥–æ", "NFT", "Telegram Premium", "15 ‚≠ê"];
      const result = prizes[Math.floor(Math.random() * prizes.length)];

      showModal(name, `–¢–µ–±–µ –≤—ã–ø–∞–ª–æ: ${result}`);
      modal.focus();
    }

    function showModal(title, text) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-text').textContent = text;
      modal.classList.remove('hidden');
    }

    function closeModal() {
      modal.classList.add('hidden');
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∫–ª–∏–∫–æ–º –≤–Ω–µ –∏ –ø–æ Escape
    modal.addEventListener('click', e => {
      if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });

    // –¢–∞–±—ã
    function initTabs() {
      const tabs = document.querySelectorAll('[role="tab"]');
      const panels = document.querySelectorAll('[role="tabpanel"]');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          activateTab(tab, tabs, panels);
        });
        tab.addEventListener('keydown', e => {
          let index = Array.prototype.indexOf.call(tabs, tab);
          if (e.key === 'ArrowRight') {
            e.preventDefault();
            const nextIndex = (index + 1) % tabs.length;
            tabs[nextIndex].focus();
          } else if (e.key === 'ArrowLeft') {
            e.preventDefault();
            const prevIndex = (index - 1 + tabs.length) % tabs.length;
            tabs[prevIndex].focus();
          }
        });
      });
    }

    function activateTab(selectedTab, tabs, panels) {
      tabs.forEach(tab => {
        tab.classList.remove('active-tab');
        tab.setAttribute('aria-selected', 'false');
        tab.setAttribute('tabindex', '-1');
      });
      panels.forEach(panel => panel.hidden = true);

      selectedTab.classList.add('active-tab');
      selectedTab.setAttribute('aria-selected', 'true');
      selectedTab.setAttribute('tabindex', '0');

      const panelId = selectedTab.getAttribute('aria-controls');
      document.getElementById(panelId).hidden = false;
    }
  </script>
</body>
</html>
